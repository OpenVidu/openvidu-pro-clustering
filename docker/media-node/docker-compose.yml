# ------------------------------------------------------------------------------
#
#    DO NOT MODIFY THIS FILE !!!
#
#    Configuration properties should be specified in .env file
#
#    This docker-compose file coordinates all services of OpenVidu CE Platform.
#
# ------------------------------------------------------------------------------

version: '3.1'

services:
    kms:
        image: ${KMS_IMAGE:-kurento/kurento-media-server:6.13.1}
        restart: always
        network_mode: host
        ulimits:
            core: -1
        volumes:
            - /opt/openvidu/recordings:/opt/openvidu/recordings
            - /core:/core
        environment:
            - KMS_MIN_PORT=40000
            - KMS_MAX_PORT=57000
            - GST_DEBUG=${KMS_DEBUG_LEVEL:-}

    nginx:
        image: openvidu/openvidu-proxy:1.0.0-beta3
        entrypoint: ["/bin/bash", "-c", "service nginx restart && tail -f /var/log/nginx/*.log"]
        restart: on-failure
        network_mode: host
        volumes:
            - ./nginx_conf/nginx.conf:/etc/nginx/nginx.conf
            - ./nginx_conf/kms-recorder.conf:/etc/nginx/conf.d/default.conf
            - /opt/openvidu/recordings:/opt/openvidu/recordings
