# ------------------------------------------------------------------------------
#
#    DO NOT MODIFY THIS FILE !!!
#
#    Configuration properties should be specified in .env file
#
#    This docker-compose file coordinates all services of OpenVidu CE Platform.
#
#    Openvidu Version: 2.13.0
#
# ------------------------------------------------------------------------------

version: '3.1'

services:
    kms:
        image: ${KMS_IMAGE:-kurento/kurento-media-server:6.13.2}
        restart: always
        network_mode: host
        ulimits:
            core: -1
        volumes:
            - /opt/openvidu/recordings:/opt/openvidu/recordings
            - /opt/openvidu/kms-crashes:/opt/openvidu/kms-crashes
        environment:
            - KMS_MIN_PORT=40000
            - KMS_MAX_PORT=57000
            - GST_DEBUG=${KMS_DEBUG_LEVEL:-}

    nginx:
        image: openvidu/openvidu-proxy:2.0.0-beta4
        entrypoint: ['/bin/sh', '-c', 'nginx -g "daemon on;" && tail -f /var/log/nginx/*.log']
        restart: on-failure
        network_mode: host
        volumes:
            - ./nginx_conf/nginx.conf:/etc/nginx/nginx.conf
            - ./nginx_conf/kms-recorder.conf:/etc/nginx/conf.d/default.conf
            - /opt/openvidu/recordings:/opt/openvidu/recordings
